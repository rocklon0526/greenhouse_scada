ğŸŒ¿ Greenhouse OS - Web SCADA System

Greenhouse OS æ˜¯ä¸€å€‹ç¾ä»£åŒ–çš„ç¶²é ç‰ˆ SCADA ç³»çµ±ï¼Œå°ˆç‚ºæ™ºæ…§æº«å®¤ç®¡ç†è¨­è¨ˆã€‚çµåˆå³æ™‚æ•¸æ“šç›£æ§ã€äº’å‹•å¼ 3D è¦–è¦ºåŒ–ä»¥åŠè‡ªå‹•åŒ–è¨­å‚™æ§åˆ¶ã€‚

ğŸ® è‡ªå‹•åŒ–æ§åˆ¶æµç¨‹ (Automation Scenarios)

ä»¥ä¸‹åœ–è¡¨æè¿°äº†ç³»çµ±çš„ä¸‰å¤§æ ¸å¿ƒè‡ªå‹•åŒ–é‚è¼¯ã€‚é€™äº›æµç¨‹æ¶µè“‹äº†ä½¿ç”¨è€…æ“ä½œã€å‰ç«¯é©—è­‰ã€å¾Œç«¯è™•ç†ã€PLC æ§åˆ¶ä»¥åŠè³‡æ–™åº«è¨˜éŒ„ã€‚

ä¸€ã€èª¿é…æ¡¶æ··åˆæµç¨‹ (Mixing Process)

æƒ…å¢ƒæè¿°ï¼š
æ­¤æµç¨‹è² è²¬æ ¹æ“šä½¿ç”¨è€…é¸æ“‡çš„é…æ–¹ï¼Œæ§åˆ¶ PLC é€²è¡Œç²¾æº–çš„åŸæ–™æ··åˆã€‚

ä½¿ç”¨è€…åœ¨å‰ç«¯é¸æ“‡é…æ–¹ï¼Œä¸¦è¼¸å…¥ç›®æ¨™æ°´é‡ã€‚

å‰ç«¯é æª¢ï¼šç³»çµ±è‡ªå‹•è¨ˆç®—æ‰€éœ€å„åŸæ–™é‡é‡ï¼Œä¸¦æ¯”å°ç•¶å‰åŸæ–™æ¡¶å­˜é‡ã€‚è‹¥ä»»ä¸€åŸæ–™ä¸è¶³ï¼Œç›´æ¥åœ¨å‰ç«¯é˜»æ“‹ä¸¦è­¦ç¤ºï¼Œä¸ç™¼é€è«‹æ±‚ã€‚

å¾Œç«¯è™•ç†ï¼šè‹¥åº«å­˜å……è¶³ï¼Œå‰ç«¯ç™¼é€è«‹æ±‚è‡³å¾Œç«¯ã€‚å¾Œç«¯å°‡åƒæ•¸å¯«å…¥ PLC ä¸¦é©—è­‰ã€‚

è£½ç¨‹åŸ·è¡Œï¼šPLC å•Ÿå‹•æ··åˆè¨­å‚™ï¼ˆé–¥é–€/æ”ªæ‹Œå™¨ï¼‰ã€‚å¾Œç«¯å®šæœŸè¼ªè©¢ PLC ç‹€æ…‹ä¸¦å¯«å…¥è³‡æ–™åº«ï¼ˆå³æ™‚æ•¸æ“šï¼‰ã€‚

æ‰£æ–™èˆ‡è­¦å ±ï¼šè£½ç¨‹çµæŸå¾Œï¼Œç³»çµ±è‡ªå‹•æ‰£é™¤åŸæ–™æ¡¶å¸³é¢åº«å­˜ã€‚è‹¥æ›´æ–°å¾Œçš„åº«å­˜ä½æ–¼å®‰å…¨é–¥å€¼ (20%)ï¼Œç³»çµ±æœƒè§¸ç™¼ä½æ°´ä½è­¦å ±ä¸¦è¨˜éŒ„ã€‚
```mermaid
sequenceDiagram
    autonumber
    participant User as ä½¿ç”¨è€…
    participant FE as å‰ç«¯ (React)
    participant BE as å¾Œç«¯ API
    participant DB as è³‡æ–™åº«
    participant PLC as PLC (Modbus)
    participant DosingTanks as åŸæ–™æ¡¶æ§½

    User->>FE: 1. é¸æ“‡é…æ–¹ (æˆåˆ†æ¯”ä¾‹ & æ°´é‡)
    FE->>FE: è¨ˆç®—å„æˆåˆ†é‡é‡ (è½‰æ› %)
    
    rect rgb(255, 250, 240)
        Note over FE, DosingTanks: é å…ˆæª¢æŸ¥åº«å­˜
        FE->>FE: æª¢æŸ¥å„åŸæ–™æ¡¶æ¶²ä½æ˜¯å¦è¶³å¤ 
        alt æ¶²ä½ä¸è¶³
            FE-->>User: âš ï¸ è­¦ç¤º: åŸæ–™ä¸è¶³ï¼Œç„¡æ³•é–‹å§‹
        else æ¶²ä½å……è¶³
            FE->>BE: POST /api/mix (é…æ–¹åƒæ•¸)
            BE->>PLC: Write Registers (è¨­å®šé…æ–¹åƒæ•¸)
            BE->>PLC: Read Registers (é©—è­‰é…æ–¹æ˜¯å¦å¯«å…¥æˆåŠŸ)
            
            alt é©—è­‰æˆåŠŸ
                BE->>PLC: Write Coil (å•Ÿå‹•è£½ç¨‹è¨Šè™Ÿ)
                BE->>DB: Insert Log (è£½ç¨‹é–‹å§‹, RecipeID)
                BE-->>FE: å›è¦†: é–‹å§‹æ··åˆ
                
                loop ç›£æ§è£½ç¨‹
                    PLC->>PLC: æ§åˆ¶é–¥é–€/æ”ªæ‹Œå™¨
                    FE->>BE: Polling Status
                    BE->>PLC: Read Status
                    BE-->>FE: æ›´æ–°æ··åˆé€²åº¦/ç‹€æ…‹
                    BE->>DB: è¨˜éŒ„å³æ™‚è£½ç¨‹æ•¸æ“š (æ¯åˆ†é˜)
                end

                rect rgb(255, 240, 240)
                    Note over PLC, DosingTanks: è£½ç¨‹çµæŸå¾Œè‡ªå‹•æ‰£æ–™
                    PLC->>DosingTanks: æ‰£é™¤å„æˆåˆ†ç”¨é‡
                    PLC->>PLC: æª¢æŸ¥å‰©é¤˜æ¶²ä½
                    
                    opt æ¶²ä½ < é–¥å€¼ (20%)
                        PLC->>BE: ç™¼é€ä½æ¶²ä½è­¦å ±
                        BE->>DB: Insert Log (è­¦å ±: åŸæ–™ä¸è¶³)
                        BE->>FE: é¡¯ç¤ºç´…ç‡ˆè­¦ç¤º/è­¦å ±é€šçŸ¥
                    end
                end
                
                BE->>DB: Insert Log (è£½ç¨‹çµæŸ, ç”¢å‡ºé‡)

            else é©—è­‰å¤±æ•—
                BE-->>FE: å›è¦†: è¨­å®šå¤±æ•—ï¼Œè«‹é‡è©¦
            end
        end
    end
```

äºŒã€èª¿é…æ¡¶å‚³é€è‡³é¤Šæ¶²æ¡¶ (Transfer Logic)

æƒ…å¢ƒæè¿°ï¼š
æ­¤æµç¨‹è² è²¬å°‡èª¿é…å¥½çš„é¤Šæ¶²å‚³é€è‡³æŒ‡å®šçš„å±¤æ¶é¤Šæ¶²æ¡¶ï¼ˆRack Tankï¼‰ã€‚

ä½¿ç”¨è€…é»æ“Šã€Œå‚³é€é¤Šæ¶²ã€æŒ‰éˆ•ã€‚

å‰ç«¯é˜²å‘†ï¼šæª¢æŸ¥ç›®æ¨™é¤Šæ¶²æ¡¶çš„ç•¶å‰æ°´ä½ã€‚è‹¥æ°´ä½éä½ä½ (L1)ï¼Œå‰‡è¦–ç‚ºé‚„æœ‰æ®˜ç•™æ¶²é«”ï¼Œç¦æ­¢è‡ªå‹•è£œæ°´ä»¥é˜²æº¢å‡ºï¼Œä¸¦æç¤ºä½¿ç”¨è€…æ‰‹å‹•æ’æ°´ã€‚

ä»»å‹™å•Ÿå‹•ï¼šè‹¥æ¢ä»¶ç¬¦åˆï¼Œå¾Œç«¯ç™¼é€æŒ‡ä»¤çµ¦ PLCï¼Œé–‹å•Ÿä¸»é–¥ã€ç›®æ¨™é–¥ä¸¦å•Ÿå‹•å¹«æµ¦ã€‚

è‡ªå‹•è£œæ°´ï¼šPLC ç›£æ§ç›®æ¨™æ¡¶çš„æµ®çƒæ¶²ä½ã€‚ç•¶æ¶²ä½åˆ°é”æ»¿æ°´ä½ (L4) æ™‚ï¼ŒPLC è‡ªå‹•é—œé–‰å¹«æµ¦èˆ‡é–¥é–€ï¼Œä¸¦å›å ±ä»»å‹™å®Œæˆã€‚
```mermaid
sequenceDiagram
    autonumber
    participant User as ä½¿ç”¨è€…
    participant FE as å‰ç«¯ (React)
    participant BE as å¾Œç«¯ API
    participant DB as è³‡æ–™åº«
    participant PLC as PLC
    participant Tank as é¤Šæ¶²æ¡¶æ„Ÿæ¸¬å™¨

    User->>FE: é»æ“Šã€Œå‚³é€é¤Šæ¶²ã€è‡³æŒ‡å®šæ¡¶æ§½
    FE->>FE: æª¢æŸ¥ç›®æ¨™æ¡¶æ§½æ°´ä½ç‹€æ…‹
    
    alt æ°´ä½ != L1 (éä½æ°´ä½)
        FE-->>User: âš ï¸ è­¦ç¤º: è«‹å…ˆæ‰‹å‹•æ’æ°´è‡³ L1
    else æ°´ä½ == L1 (ç¬¦åˆæ¢ä»¶)
        FE->>BE: POST /api/transfer (Source, Target)
        BE->>PLC: é–‹å•Ÿä¸»é–¥ & ç›®æ¨™æ¡¶é–¥é–€
        BE->>PLC: å•Ÿå‹•å¹«æµ¦ (Pump ON)
        BE->>DB: Insert Log (å‚³é€ä»»å‹™é–‹å§‹, TargetID)
        BE-->>FE: ä»»å‹™é–‹å§‹
        
        loop è‡ªå‹•è£œæ°´ç›£æ§
            PLC->>Tank: è®€å–æµ®çƒæ¶²ä½
            Tank-->>PLC: å›å‚³æ¶²ä½ (L1...L4)
            
            opt æ¶²ä½åˆ°é” L4 (æ»¿æ°´ä½)
                PLC->>PLC: é—œé–‰å¹«æµ¦ & é–¥é–€
                PLC->>BE: å›å ±ä»»å‹™å®Œæˆ
                BE->>DB: Insert Log (å‚³é€ä»»å‹™å®Œæˆ)
            end
        end
        BE-->>FE: æ›´æ–°ç‹€æ…‹: é–’ç½® (Idle)
    end
```

ä¸‰ã€ç’°å¢ƒæ§åˆ¶è‡ªå‹•åŒ– (Environmental Control)

æƒ…å¢ƒæè¿°ï¼š
ç³»çµ±å…¨å¤©å€™ç›£æ§æº«å®¤ç’°å¢ƒï¼Œä¸¦æ ¹æ“šè¨­å®šçš„é‚è¼¯è‡ªå‹•èª¿ç¯€è¨­å‚™ã€‚

ç›£æ§è¿´åœˆï¼šå¾Œç«¯å®šæœŸè®€å–æ„Ÿæ¸¬å™¨æ•¸å€¼ï¼Œä¸¦å¯«å…¥è³‡æ–™åº«ä½œç‚ºæ­·å²ç´€éŒ„ã€‚

æ¨¡å¼åˆ¤æ–·ï¼šæª¢æŸ¥ç³»çµ±æ˜¯å¦è™•æ–¼ã€Œè‡ªå‹•æ¨¡å¼ (AUTO)ã€ã€‚è‹¥ç‚ºæ‰‹å‹•æ¨¡å¼å‰‡ä¸ä»‹å…¥ã€‚

é–¥å€¼æª¢æŸ¥ï¼šè‹¥åœ¨è‡ªå‹•æ¨¡å¼ä¸”ç³»çµ±é–’ç½®ï¼Œæª¢æŸ¥æº«åº¦æˆ–æ¿•åº¦æ˜¯å¦è¶…å‡ºè¨­å®šçš„å®‰å…¨é–¥å€¼ã€‚

è¦å‰‡åŸ·è¡Œï¼šè‹¥è¶…å‡ºé–¥å€¼ï¼Œç³»çµ±æ ¹æ“šå„ªå…ˆæ¬ŠæŸ¥è©¢å•Ÿç”¨çš„è¦å‰‡ã€‚è‹¥æ‰¾åˆ°ç¬¦åˆçš„è¦å‰‡ï¼Œå‰‡åŸ·è¡Œå°æ‡‰å‹•ä½œï¼ˆå¦‚é–‹å•Ÿé¢¨æ‰‡ï¼‰ã€‚

ä»»å‹™è¨ˆæ™‚ï¼šè¨­å‚™å•Ÿå‹•å¾Œæœƒé€²å…¥ã€Œä»»å‹™åŸ·è¡Œä¸­ã€ç‹€æ…‹ä¸¦å€’æ•¸è¨ˆæ™‚ï¼ˆä¾‹å¦‚ 15 åˆ†é˜ï¼‰ã€‚åœ¨æ­¤æœŸé–“ç³»çµ±ä¸æœƒé‡è¤‡è§¸ç™¼è¦å‰‡ã€‚

ä»»å‹™çµæŸï¼šå€’æ•¸çµæŸå¾Œï¼Œç³»çµ±è‡ªå‹•é—œé–‰è¨­å‚™ï¼Œå¯«å…¥ä»»å‹™çµæŸç´€éŒ„ï¼Œä¸¦å›åˆ°å¾…æ©Ÿç›£æ§ç‹€æ…‹ã€‚

```mermaid
sequenceDiagram
    autonumber
    participant FE as å‰ç«¯ (React)
    participant BE as å¾Œç«¯ (Logic Engine)
    participant DB as è³‡æ–™åº«
    participant PLC as PLC (Sensors/IO)

    Note over FE, PLC: ç›£æ§è¿´åœˆ (ç³»çµ±æ¯ 2 ç§’åŸ·è¡Œä¸€æ¬¡)

    BE->>PLC: è®€å–ç’°å¢ƒæ„Ÿæ¸¬å™¨ (æº«æ¿•åº¦)
    PLC-->>BE: å›å‚³æ•¸å€¼ (Temp/Hum)
    BE->>DB: Insert Sensor History (å®šæ™‚å„²å­˜)
    BE-->>FE: æ¨é€å³æ™‚ç‹€æ…‹ (ç•«é¢å‘ˆç¾)
    
    Note over BE: 1. åˆ¤æ–·è‡ªå‹•æ¨¡å¼
    alt è‡ªå‹•æ¨¡å¼ = ON
        
        alt ç³»çµ±ç‹€æ…‹ = åŸ·è¡Œä»»å‹™ä¸­ (Running Task)
            Note over BE: å€’æ•¸è¨ˆæ™‚ä¸­... (Wait N mins)
            BE->>BE: æª¢æŸ¥è¨ˆæ™‚å™¨æ˜¯å¦çµæŸ
            opt è¨ˆæ™‚çµæŸ
                BE->>PLC: é—œé–‰è¨­å‚™ / å›å¾©å¾…æ©Ÿ
                BE->>DB: Insert Log (è‡ªå‹•åŒ–ä»»å‹™çµæŸ)
                BE->>BE: ç‹€æ…‹è¨­ç‚º Idle
            end
            
        else ç³»çµ±ç‹€æ…‹ = å¾…æ©Ÿ (Idle)
            Note over BE: 2. åˆ¤æ–·å®‰å…¨é–¥å€¼
            BE->>BE: æª¢æŸ¥ æº«åº¦ > TempThreshold OR æ¿•åº¦ > HumThreshold?
            
            opt è¶…å‡ºé–¥å€¼
                Note over BE: 3. åŸ·è¡Œå„ªå…ˆæ¬Šè¦å‰‡
                BE->>DB: æŸ¥è©¢å•Ÿç”¨ä¸­çš„è¦å‰‡ (Logè®€å–)
                
                loop é€é …åˆ¤æ–·è¦å‰‡ (æŒ‰å„ªå…ˆåº)
                    alt è¦å‰‡ç¬¦åˆä¸”å•Ÿç”¨
                        Note over BE: 4. åŸ·è¡Œå°æ‡‰æ‰‹æ®µ
                        BE->>PLC: å•Ÿç”¨è¨­å‚™ (é¢¨æ‰‡/æ°´ç‰†)
                        BE->>DB: Insert Log (è§¸ç™¼è¦å‰‡: RuleID, Action)
                        BE->>BE: è¨­å®šè¨ˆæ™‚å™¨ (ä¾‹å¦‚ 15åˆ†é˜)
                        BE->>BE: ç‹€æ…‹è¨­ç‚º Running Task
                        Note over BE: è§¸ç™¼å¾Œè·³å‡ºè¦å‰‡æª¢æŸ¥
                    end
                end
            end
        end
        
    else æ‰‹å‹•æ¨¡å¼
        Note over BE: ç­‰å¾…ä½¿ç”¨è€…æ‰‹å‹•æ“ä½œ
    end
```

ğŸ§ª åŠŸèƒ½æ¸¬è©¦æŒ‡å— (Testing Guide)

ç”±æ–¼ç³»çµ±é‚è¼¯è¼ƒç‚ºè¤‡é›œï¼Œå‰ç«¯å·²å¯¦ä½œå°æ‡‰çš„æŒ‰éˆ•èˆ‡è¨­å®šä»‹é¢ä¾›æ¸¬è©¦ä½¿ç”¨ï¼š

æ¸¬è©¦ã€Œæ··åˆæµç¨‹ã€:

    é€²å…¥ é…æ–¹ç®¡ç† (Formulas) é é¢ã€‚

    åœ¨ä»»æ„é…æ–¹å¡ç‰‡ä¸Šé»æ“Š ã€ŒStart Mixã€ æŒ‰éˆ•ã€‚

    è§€å¯Ÿ 3D è¦–åœ–ä¸­çš„ä¸»èª¿é…æ¡¶ (Mixer) ç‹€æ…‹è®Šç‚º Mixingï¼Œé€²åº¦æ¢é–‹å§‹è·‘å‹•ï¼Œå®Œæˆå¾Œæœƒè‡ªå‹•æ‰£é™¤åŸæ–™æ¡¶æ¶²ä½ã€‚

æ¸¬è©¦ã€Œå‚³é€/è£œæ°´æµç¨‹ã€:

    é€²å…¥ 3D ç›£æ§ (Monitor) æˆ– Dashboardã€‚

    é»æ“Šä»»æ„ å±¤æ¶ (Rack) æˆ–å…¶é¤Šæ¶²æ¡¶ã€‚

    åœ¨å³å´å½ˆå‡ºçš„è©³ç´°è³‡è¨Šé¢æ¿ä¸­ï¼Œè‹¥æ°´ä½ç‚º L1ï¼Œæœƒé¡¯ç¤º ã€ŒStart Refillã€ æŒ‰éˆ•ã€‚

    é»æ“Šå¾Œï¼Œè§€å¯Ÿ 3D è¦–åœ–ä¸­çš„ç®¡ç·šè®Šè‰²ï¼Œä¸”ç›®æ¨™æ¡¶æ°´ä½é€æ¼¸ä¸Šå‡è‡³ L4ã€‚

æ¸¬è©¦ã€Œç’°å¢ƒæ§åˆ¶ã€:

    é€²å…¥ è‡ªå‹•åŒ–é‚è¼¯ (Automation Logic) é é¢ã€‚

    èª¿æ•´ ã€Œæº«åº¦é–¥å€¼ã€ æˆ–æ–°å¢çš„ ã€Œæ¿•åº¦é–¥å€¼ã€ã€‚

    ç¢ºä¿ç³»çµ±è™•æ–¼ AUTO æ¨¡å¼ã€‚

    è‹¥æ¨¡æ“¬æ•¸æ“šè¶…å‡ºè¨­å®šå€¼ï¼ŒDashboard ä¸Šçš„é¢¨æ‰‡æœƒè‡ªå‹•é–‹å•Ÿï¼Œä¸¦é€²å…¥å€’æ•¸è¨ˆæ™‚ç‹€æ…‹ã€‚

ğŸš€ Getting Started

Follow these steps to set up the project locally.

Prerequisites

Node.js (v16 or higher)

npm or yarn

Installation

Clone the repository

git clone [https://github.com/rocklon0526/greenhouse_scada.git](https://github.com/rocklon0526/greenhouse_scada.git)
cd greenhouse_scada


Install dependencies

npm install


Run Development Server

npm run dev


Open http://localhost:5173 to view it in the browser.