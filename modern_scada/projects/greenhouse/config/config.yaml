alarms:
  - message: Outdoor Temperature High!
    tag_name: weather_temp
    threshold: 40.0
    type: high
  - message: Mixer pH High!
    tag_name: mixer_ph
    threshold: 8.0
    type: high
  - message: Mixer pH Low!
    tag_name: mixer_ph
    threshold: 4.0
    type: low
  - message: Greenhouse Temp High!
    tag_name: sensor_01_top_temp # 修正為具體 Tag
    threshold: 35.0
    type: high

database:
  postgres_dsn: postgresql://postgres:password@timeseries-db:5432/scada
  sqlite_path: data/buffer.db

plc:
  connections:
    - host: plc-sim
      name: Main PLC
      poll_interval: 1.0
      port: 502

# 新增：第三方設備控制設定 (對應 device_control_service.py)
vendor_control:
  url: "http://host.docker.internal:8888/vendor/control" # 假設 Vendor 跑在 Host 或另一個容器
  device_prefix: "nursery_"
  timeout: 5.0

security:
  access_token_expire_minutes: 30
  algorithm: HS256

tags:
  # --- Weather Station ---
  - address: 0
    connection_name: Main PLC
    name: weather_temp
    type: float
    unit: "°C"
  - address: 2
    connection_name: Main PLC
    name: weather_hum
    type: float
    unit: '%'
  - address: 4
    connection_name: Main PLC
    name: weather_uv
    type: float
    unit: index

  # --- Mixer System ---
  - address: 10
    connection_name: Main PLC
    name: mixer_level
    type: float
    unit: L
  - address: 12
    connection_name: Main PLC
    name: mixer_ph
    type: float
    unit: pH
  - address: 14
    connection_name: Main PLC
    name: mixer_ec
    type: float
    unit: mS/cm
  - address: 16
    connection_name: Main PLC
    name: mixer_valve
    type: bool # 修正名稱以對應 state_builder (valveOpen mapping)
    unit: bool
  - address: 18
    connection_name: Main PLC
    name: mixer_pump
    type: bool # 修正名稱以對應 state_builder (pumpActive mapping)
    unit: bool

  # --- Dosing Tanks (1-6) ---
  - address: 20
    connection_name: Main PLC
    name: dosing_1_level
    type: float
    unit: kg
  - address: 22
    connection_name: Main PLC
    name: dosing_2_level
    type: float
    unit: kg
  - address: 24
    connection_name: Main PLC
    name: dosing_3_level
    type: float
    unit: kg
  - address: 26
    connection_name: Main PLC
    name: dosing_4_level
    type: float
    unit: kg
  - address: 28
    connection_name: Main PLC
    name: dosing_5_level
    type: float
    unit: kg
  - address: 30
    connection_name: Main PLC
    name: dosing_6_level
    type: float
    unit: kg

  # --- Racks (Rack A) ---
  # 目前 Simulator 僅定義了 Rack A (40-46)
  - address: 40
    connection_name: Main PLC
    name: rack_a_level # 對應 state_builder 的 rack_id 生成邏輯
    type: float
    unit: level
  - address: 42
    connection_name: Main PLC
    name: rack_a_ph
    type: float
    unit: pH
  - address: 44
    connection_name: Main PLC
    name: rack_a_ec
    type: float
    unit: mS/cm
  - address: 46
    connection_name: Main PLC
    name: rack_a_valve
    type: bool
    unit: bool

  # --- Sensors (1-6) ---
  # 每個感測器間隔 20 registers (18 used + 2 gap)
  
  # Sensor 01 (Base 100)
  - address: 100
    connection_name: Main PLC
    name: sensor_01_top_temp
    type: float
    unit: "°C"
  - address: 102
    connection_name: Main PLC
    name: sensor_01_top_hum
    type: float
    unit: "%"
  - address: 104
    connection_name: Main PLC
    name: sensor_01_top_co2
    type: float
    unit: ppm
  - address: 106
    connection_name: Main PLC
    name: sensor_01_mid_temp
    type: float
    unit: "°C"
  - address: 108
    connection_name: Main PLC
    name: sensor_01_mid_hum
    type: float
    unit: "%"
  - address: 110
    connection_name: Main PLC
    name: sensor_01_mid_co2
    type: float
    unit: ppm
  - address: 112
    connection_name: Main PLC
    name: sensor_01_bot_temp
    type: float
    unit: "°C"
  - address: 114
    connection_name: Main PLC
    name: sensor_01_bot_hum
    type: float
    unit: "%"
  - address: 116
    connection_name: Main PLC
    name: sensor_01_bot_co2
    type: float
    unit: ppm

  # Sensor 02 (Base 120)
  - address: 120
    connection_name: Main PLC
    name: sensor_02_top_temp
    type: float
    unit: "°C"
  - address: 122
    connection_name: Main PLC
    name: sensor_02_top_hum
    type: float
    unit: "%"
  - address: 124
    connection_name: Main PLC
    name: sensor_02_top_co2
    type: float
    unit: ppm
  - address: 126
    connection_name: Main PLC
    name: sensor_02_mid_temp
    type: float
    unit: "°C"
  - address: 128
    connection_name: Main PLC
    name: sensor_02_mid_hum
    type: float
    unit: "%"
  - address: 130
    connection_name: Main PLC
    name: sensor_02_mid_co2
    type: float
    unit: ppm
  - address: 132
    connection_name: Main PLC
    name: sensor_02_bot_temp
    type: float
    unit: "°C"
  - address: 134
    connection_name: Main PLC
    name: sensor_02_bot_hum
    type: float
    unit: "%"
  - address: 136
    connection_name: Main PLC
    name: sensor_02_bot_co2
    type: float
    unit: ppm

  # Sensor 03 (Base 140)
  - address: 140
    connection_name: Main PLC
    name: sensor_03_top_temp
    type: float
    unit: "°C"
  - address: 142
    connection_name: Main PLC
    name: sensor_03_top_hum
    type: float
    unit: "%"
  - address: 144
    connection_name: Main PLC
    name: sensor_03_top_co2
    type: float
    unit: ppm
  - address: 146
    connection_name: Main PLC
    name: sensor_03_mid_temp
    type: float
    unit: "°C"
  - address: 148
    connection_name: Main PLC
    name: sensor_03_mid_hum
    type: float
    unit: "%"
  - address: 150
    connection_name: Main PLC
    name: sensor_03_mid_co2
    type: float
    unit: ppm
  - address: 152
    connection_name: Main PLC
    name: sensor_03_bot_temp
    type: float
    unit: "°C"
  - address: 154
    connection_name: Main PLC
    name: sensor_03_bot_hum
    type: float
    unit: "%"
  - address: 156
    connection_name: Main PLC
    name: sensor_03_bot_co2
    type: float
    unit: ppm

  # Sensor 04 (Base 160)
  - address: 160
    connection_name: Main PLC
    name: sensor_04_top_temp
    type: float
    unit: "°C"
  - address: 162
    connection_name: Main PLC
    name: sensor_04_top_hum
    type: float
    unit: "%"
  - address: 164
    connection_name: Main PLC
    name: sensor_04_top_co2
    type: float
    unit: ppm
  - address: 166
    connection_name: Main PLC
    name: sensor_04_mid_temp
    type: float
    unit: "°C"
  - address: 168
    connection_name: Main PLC
    name: sensor_04_mid_hum
    type: float
    unit: "%"
  - address: 170
    connection_name: Main PLC
    name: sensor_04_mid_co2
    type: float
    unit: ppm
  - address: 172
    connection_name: Main PLC
    name: sensor_04_bot_temp
    type: float
    unit: "°C"
  - address: 174
    connection_name: Main PLC
    name: sensor_04_bot_hum
    type: float
    unit: "%"
  - address: 176
    connection_name: Main PLC
    name: sensor_04_bot_co2
    type: float
    unit: ppm

  # Sensor 05 (Base 180)
  - address: 180
    connection_name: Main PLC
    name: sensor_05_top_temp
    type: float
    unit: "°C"
  - address: 182
    connection_name: Main PLC
    name: sensor_05_top_hum
    type: float
    unit: "%"
  - address: 184
    connection_name: Main PLC
    name: sensor_05_top_co2
    type: float
    unit: ppm
  - address: 186
    connection_name: Main PLC
    name: sensor_05_mid_temp
    type: float
    unit: "°C"
  - address: 188
    connection_name: Main PLC
    name: sensor_05_mid_hum
    type: float
    unit: "%"
  - address: 190
    connection_name: Main PLC
    name: sensor_05_mid_co2
    type: float
    unit: ppm
  - address: 192
    connection_name: Main PLC
    name: sensor_05_bot_temp
    type: float
    unit: "°C"
  - address: 194
    connection_name: Main PLC
    name: sensor_05_bot_hum
    type: float
    unit: "%"
  - address: 196
    connection_name: Main PLC
    name: sensor_05_bot_co2
    type: float
    unit: ppm

  # Sensor 06 (Base 200)
  - address: 200
    connection_name: Main PLC
    name: sensor_06_top_temp
    type: float
    unit: "°C"
  - address: 202
    connection_name: Main PLC
    name: sensor_06_top_hum
    type: float
    unit: "%"
  - address: 204
    connection_name: Main PLC
    name: sensor_06_top_co2
    type: float
    unit: ppm
  - address: 206
    connection_name: Main PLC
    name: sensor_06_mid_temp
    type: float
    unit: "°C"
  - address: 208
    connection_name: Main PLC
    name: sensor_06_mid_hum
    type: float
    unit: "%"
  - address: 210
    connection_name: Main PLC
    name: sensor_06_mid_co2
    type: float
    unit: ppm
  - address: 212
    connection_name: Main PLC
    name: sensor_06_bot_temp
    type: float
    unit: "°C"
  - address: 214
    connection_name: Main PLC
    name: sensor_06_bot_hum
    type: float
    unit: "%"
  - address: 216
    connection_name: Main PLC
    name: sensor_06_bot_co2
    type: float
    unit: ppm

  # --- Control Registers ---
  - address: 300
    connection_name: Main PLC
    name: process_mix_cmd # 對應 API 寫入的 tag 名稱
    type: float
    unit: cmd
  - address: 301
    connection_name: Main PLC
    name: process_recipe_id
    type: float
    unit: id
  - address: 310
    connection_name: Main PLC
    name: process_transfer_cmd
    type: float
    unit: cmd
  - address: 311
    connection_name: Main PLC
    name: process_transfer_target
    type: float
    unit: id

  # --- Virtual Tags (Actuators) ---
  # 這些在模擬器中可能需要透過 device_control_service.py 控制
  # 為了讓前端能讀取狀態，我們先對應到模擬器中的 valve (Address 16) 或其他位置
  - address: 400
    connection_name: Main PLC
    name: fan_1_status
    type: float
    unit: bool
  - address: 401
    connection_name: Main PLC
    name: fan_2_status
    type: float
    unit: bool
  - address: 402
    connection_name: Main PLC
    name: ww_1_status
    type: float
    unit: bool
  - address: 403
    connection_name: Main PLC
    name: ww_2_status
    type: float
    unit: bool